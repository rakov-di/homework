Вернуться на [главную](README.md)

## Содержание <a name = "content_table"></a>

- [Описание](#about)
- [Начало работы](#getting_started)
- [Структура файлов](#file_tree)
- [TODO](#todo)

## Описание <a name = "about"></a>

На данный момент созданы 28 unit-тестов для контроллеров сервера и 31 интеграционный тестов для клиентских страниц.

### Unit-тесты

Написаны с использованием mocha, chai, sinon.

Для всех сценариев происходит проверка:
1. Соответствие кода ответа (200 или 500)
2. Для запросов, в которых пользователю отправляются данные - верность этих данных (прежде всего вложенность объектов ответа)
3. Для запроса на обновление настроек - корректность отдаваемого сообщения (т.к. оно пробрасывается на клиент и выводится пользователю).

Сценарии:
- контроллер Получения настроек репозитория
    - Запрос успешен, текущие настройки получены
    - Запрос успешен, текущий настройки отсутствуют
    - Запрос завершился с ошибкой
- контроллер Сохранения настроек репозитория
    - Запрос успешен, настройки сохранены
    - Запрос завершился с ошибкой
- контроллер Получения списка билдов
    - Запрос успешен, список билдов получен, список не пустой
    - Запрос успешен, список билдов получен, список пустой
    - Запрос завершился с ошибкой
- контроллер Постановки билда в очередь билдов
    - Запрос успешен, билд поставлен в очередь
    - Запрос завершился с ошибкой
- контроллер получения детальной информации о билде
    - Запрос успешен, детальная информация получена
    - Запрос завершился с ошибкой
- контроллер получения лога билда
    - Запрос успешен, логи билда получены
    - Запрос завершился с ошибкой

### Интеграционные тесты
Написаны с использованием hermione

По сути у меня e2e тесты, т.к. пока не удается замокать сетевые запросы к апи. Поэтому тесты, связанные с api могут падать, т.к. api периодически отваливается. Остальные тесты должны проходить. 
Тесты проходят с тем же api-хранилищем, что используется в продакшне, что не хорошо. Надо бы либо иметь отдельное хранилище, либо мокать обращение к api.

Основные проверки:
- загрузка страниц по определенным url
- корректные действия по кликам на кнопки (переход на страницы или блокирова/разблокировка кнопок и отправка запроса)
- корректность заполнения полей формы (обязательные поля не пусты, поле с минутами не дает вводить что-то кроме цифр)

Вернуться [К содержанию](#content_table)

## Начало работы <a name = "getting_started"></a>

Для запуска тестов - в корне репозитория необходимо установить все npm-зависимости:
```bash
npm i
``` 
Установить и запустить в отдельной вкладке selenium
```bash
selenium-standalone start
```
Создать в папке [server](server) файл `.env` и записать туда свой токен для авторизации в виде SHRI_API_KEY=... (Bearer писать не надо, пример файла - [.env.example](server/.env.example)):

Запустить сервер:
```bash
cd server
npm i
node app.js
```

Запустить клиент: 
```bash
cd client
npm i
npm start
```

Запустить тесты:
```bash
npm test
``` 
Отдельный запуск unit и интеграционных тестов:
```bash
npm run tests_unit
npm run tests_hermione
``` 

Вернуться [К содержанию](#content_table)

## Структура файлов <a name = "file_tree"></a>

- [tests](tests) - папка со всеми тестами
- [unit-tests](tests/unit-tests) - unit-тесты для сервера (внутренняя структура папок тестов повторяет структуру папок сервера, тесты для каждого контроллера - в отдельном файле)
- [intagration-tests](tests/intagration-tests) интеграционные тесты для клиента (тесты разбиты на 4 файла - по страницам приложения)
- [hermione-reports](tests/hermione-reports) отчеты html-reporter об интеграционных тестах

Вернуться [К содержанию](#content_table)

## TODO

- Интеграционные тесты для клиента
   - Настроить тесты скриншотами (assertView)
   - Добавить лишние файлы отчетов в `.gitignore`
   - Тесты для страницы build-details
- Создать unit-тесты для git-операций на сервера

Вернуться [К содержанию](#content_table)

Вернуться на [главную](README.md)
