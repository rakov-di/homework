Вернуться на [главную](README.md)

> Некоторые тесты готовы (см. [Описание](#about)) но совсем не все, что хотелось бы (см. [TODO](#todo)). Продолжаю работу. Уделю еще как минимум среду. Если вдруг если возможность проверить работу чуть позже - в ней будет сделано чуть больше и лучше. 

## Содержание <a name = "content_table"></a>

- [Описание](#about)
- [Начало работы](#getting_started)
- [Структура файлов](#file_tree)
- [TODO](#todo)

## Описание <a name = "about"></a>

**На данный момент созданы 28 unit-тестов для контроллеров сервера и 16 интеграционных тестов для клиентских страниц start-screen и settings**:

### Unit-тесты

Написаны с использованием mocha, chai, sinon.

Для всех сценариев происходит проверка:
1. Соответствие кода ответа (200 или 500)
2. Для запросов, в которых пользователю отправляются данные - верность этих данных (прежде всего вложенность объектов ответа)
3. Для запроса на обновление настроек - корректность отдаваемого сообщения (т.к. оно пробрасывается на клиент и выводится пользователю).

Сценарии:
- контроллер Получения настроек репозитория
    - Запрос успешен, текущие настройки получены
    - Запрос успешен, текущий настройки отсутствуют
    - Запрос завершился с ошибкой
- контроллер Сохранения настроек репозитория
    - Запрос успешен, настройки сохранены
    - Запрос завершился с ошибкой
- контроллер Получения списка билдов
    - Запрос успешен, список билдов получен, список не пустой
    - Запрос успешен, список билдов получен, список пустой
    - Запрос завершился с ошибкой
- контроллер Постановки билда в очередь билдов
    - Запрос успешен, билд поставлен в очередь
    - Запрос завершился с ошибкой
- контроллер получения детальной информации о билде
    - Запрос успешен, детальная информация получена
    - Запрос завершился с ошибкой
- контроллер получения лога билда
    - Запрос успешен, логи билда получены
    - Запрос завершился с ошибкой

### Интеграционные тесты
Написаны с использованием hermione

По сути у меня e2e тесты, т.к. ничего не мокается.
К сожалению, пока не удается замокать сетевые запросы к апи или настроить удаление/сохранение настроек репозитория перед каждым тестом, т.к. не подхватывается ключ авторизации из переменных окружения (только если прописывать вручную в файле). Поэтому тесты для страницы Start-screen проходят только если настройки репозитория отсутствуют. Тесты для страницы Settings должны проходить в любом случае.

Вернуться [К содержанию](#content_table)

## Начало работы <a name = "getting_started"></a>

Для запуска тестов - в корне репозитория необходимо установить все npm-зависимости:
```bash
npm i
``` 
Установить и запустить в отдельной вкладке selenium
```bash
selenium-standalone start
```
Запустить сервер и клиент:
```bash
cd server
npm i
node app.js
```
```bash
cd client
npm i
npm start
```
Запустить тесты:
```bash
npm test
``` 
Отдельный запуск unit и интеграционных тестов:
```bash
npm run tests_unit
npm run tests_hermione
``` 

Вернуться [К содержанию](#content_table)

## Структура файлов <a name = "file_tree"></a>

- [tests](tests) - папка со всеми тестами
- [unit-tests](unit-tests) - unit-тесты для сервера (внутренняя структура папок тестов повторяет структуру папок сервера, тесты для каждого контроллера - в отдельном файле)
- [intagration-tests](intagration-tests) интеграционные тесты для клиента (тесты разбиты на 4 файла - по страницам приложения)
- [hermione-reports](hermione-reports) отчеты html-reporter об интеграционных тестах

Вернуться [К содержанию](#content_table)

## TODO

- Интеграционные тесты для клиента
   - научиться таки очищать/сохранять настройки репозитория перед тестами, либо мокать сетевые запросы
   - Настроить тесты скриншотами (assertView)
   - Тесты для страниц build-settins и build-details
- Создать unit-тесты для git-операций на сервера

Вернуться [К содержанию](#content_table)

Вернуться на [главную](README.md)
